/**
 * MIT License
 * 
 * Copyright (c) 2018 Dan From
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 * @author Dan From <dan.from@gmail.com>
 * @version 1.0.0
**/

var VanillaTree=function(){"use strict";var s=null,l=null,x=null,r=null,N=null,v=null,h=null,f=null,a={animationLength:.5,animations:!0,canDeselect:!0,checkboxFirst:!1,checkboxes:!1,fadeOnRemove:!0,maxLevels:-1,moveable:!0,rootDelete:!1,selectMultiple:!1,showControlsOnHover:!0,style:""},y={},A=Object.assign||function(e,t){var n={};for(var a in e)n[a]=e[a];for(var a in t)n[a]=t[a];return n},e=function(e,t,n){if(y=A(a,n),r=JSON.parse(JSON.stringify(t)),N=JSON.parse(JSON.stringify(t)),void 0===(x=e).style.position&&(x.style.positon="relative"),"undefined"===x||null===x)throw new Error("Treeview container not set");return S({silent:!1}),y.moveable&&(document.body.addEventListener("dragstart",H),document.body.addEventListener("dragend",D),document.body.addEventListener("dragover",M),document.body.addEventListener("dragenter",I),document.body.addEventListener("dragleave",R),document.body.addEventListener("drop",F)),document.body.addEventListener("click",V),y.showControlsOnHover&&(document.body.addEventListener("mouseover",j,!1),document.body.addEventListener("mouseout",Y)),function(e){var t,n,a,r,d,o,s,l,i,c,u,p,v,h,f,m=null,b=null,g=arguments.length;switch(1===g&&("string"==typeof e||"object"==typeof e&&(L=m=e)),2===g&&(L=arguments[1]),3===g&&(m=arguments[1],L=arguments[2]),4===g&&(m=arguments[1],b=arguments[2],L=arguments[3]),e){case"getIndexesOfSelected":var L=A({silent:!1},L);return h=x.querySelectorAll("li.treeNode.selected"),f=[],h.forEach(function(e){f[f.length]=e.getAttribute("data-index")}),f;case"getBundle":return K(m);case"rebuild":return S(L=A({silent:!1},L));case"expand":L=A({silent:!1},L);return i=L,(c=K(m))[0],u=c[1],p=c[2],v=c[3],G(p,"expanded",!0,!1),u.classList.add("expanded"),void(i.silent||z(u,v,"vtv.nodeExpanded"));case"expandAll":L=A({silent:!1},L);return l=L,x.querySelectorAll(".treeNode.expandable").forEach(function(e){e.classList.contains("expanded")||e.classList.add("expanded")}),G(N,"expanded",!0,!1),void(l.silent||z(x.querySelector(".treeBranch.root"),x,"vtv.allNodesExpanded"));case"collapse":L=A({silent:!1},L);return a=L,(r=K(m))[0],d=r[1],o=r[2],s=r[3],d.classList.remove("expanded"),G(o,"expanded",!1,!1),void(a.silent||z(d,s,"vtv.nodeCollapsed"));case"collapseAll":L=A({silent:!1},L);return n=L,x.querySelectorAll(".treeNode.expandable").forEach(function(e){e.classList.remove("expanded")}),G(N,"expanded",!1,!0),void(n.silent||z(x.querySelector(".treeBranch.root"),x,"vtv.allNodesCollapsed"));case"getAllNodes":return N;case"getAllElements":return x.children;case"addNode":k(m,L=A({silent:!1},L));break;case"addNodeBefore":!function(e,t,n){var a;"string"==typeof t?(a=t,t=x.querySelector('[data-index="'+a+'"]')):void 0!==t.style||(a=t.index,t=x.querySelector('[data-index="'+a+'"]'));var r=J(a),d=t.parentNode,o=d.getAttribute("data-index"),s=o.split(".").length,l=d.querySelectorAll(":scope > ul > li").length;a=o+(""!==o?".":"")+l,i.index=a;var i=q(e,s,a);d.insertBefore(i,t),E(x.querySelector(":scope > ul.treeBranch"),r),n.silent||z(i,d,"vtv.nodeAddedBefore")}(m,b,L=A({silent:!1},L));break;case"addNodeAfter":!function(e,t,n){"string"==typeof t?(l=t,t=x.querySelector('[data-index="'+l+'"]')):void 0!==before.style||(l=t.index,t=x.querySelector('[data-index="'+l+'"]'));var a=J(l),r=t.parentNode,d=r.getAttribute("data-index"),o=d.split(".").length,s=r.querySelectorAll(":scope > ul > li").length,l=d+(""!==d?".":"")+s;e.index=l;var i=q(e,o,l),c=t.parentNode;c.insertBefore(i,t.nextSibling),E(c,a),n.silent||z(close,_treeviewPopup,"vtv.nodeAddedAfter")}(m,b,L=A({silent:!1},L));break;case"remove":return w(m,L=A({silent:!1,fadeOnRemove:y.fadeOnRemove},L));case"getExpanded":return x.querySelectorAll(".treeNode.expanded");case"getCollapsed":return t=[],x.querySelectorAll(".treeNode:not(.expanded)").forEach(function(e){(function(e){for(var t=e.parentNode;t!==x&&!t.classList.contains("expanded");)t=t.parentNode;return t.classList.contains("expanded")})(e)||(t[t.length]=e)}),new C(t);case"checkNode":return function(e,t){if(!y.checkboxes)return;var n=K(e),a=(n[0],n[1]),r=n[2],d=n[3];a.querySelectorAll(':scope > .treeNodeItem > .treeNodeCheckbox > input[type="checkbox"]').setAttribute("checked",!0),G(r,"checked",!0,!1),t.silent||triggerEventtriggerEvent(a,d,"vtv.nodeChecked")}(m,L=A({silent:!1},L));case"checkAllNodes":return function(e){if(!y.checkboxes)return;x.querySelectorAll('input[type="checkbox"]').foreach(function(e){e.checked=!0}),G(treeNode,"checked",!0,!0),e.silent||z(x.querySelector(".treeBranch.root"),x,"vtv.allNodesChecked")}(L=A({silent:!1},L));case"checkAllOpenedNodes":case"checkAllOpenedNodes":return B(L=A({silent:!1},L))}}};e.styles={default:"",dark:"dark"};var d,C=(d=document.createDocumentFragment().childNodes,function(e){e instanceof Array||e instanceof HTMLCollection||(e=[e]);var t=0,n={};return e.forEach(function(e){n[t+""]={value:e,enumerable:!0},t++}),n.length={value:e.length},n.item={value:function(e){return this[+e||-1]},enumerable:!0},Object.create(d,n)});function E(t,n,s){void 0===s&&(s=""),o(),window.setTimeout(function(){s||(s="");var e=t.querySelectorAll(":scope > li.treeNode"),o=n.nodes;e.forEach(function(e,t){var n=e.getAttribute("data-index"),a=(e.querySelector(":scope > ul.treeBranch"),s+(""===s?"":".")+t),r=o[t];a!==n&&(e.setAttribute("data-index",a),r.index=a),void 0===r.nodes&&(r.nodes=[]);var d=e.querySelector(":scope > ul.treeBranch");null!==d&&0<d.querySelectorAll(":scope > li.treeNode").length&&E(d,r,a)}),i()},0)}function S(t){x.innerHTML="",o(),window.setTimeout(function(){for(var e in N=JSON.parse(JSON.stringify(r)))a=N[e],n=b([a],0,""),y.animations&&n.classList.add("animated"),x.appendChild(n);t.silent||z(x,x,"vtv.buildDone"),i()},0);var n=null,a=null}function o(){if(null===x.querySelector("#treeViewLoading")){var e=document.createElement("div");e.classList.add("treeview-loading-bg"),e.setAttribute("id","treeViewLoading");var t=document.createElement("span");t.classList.add("spanner");var n=document.createElement("i");n.classList.add("fa"),n.classList.add("fa-fw"),n.classList.add("fa-5x"),n.classList.add("fa-spinner"),n.classList.add("fa-spin"),e.appendChild(t),e.appendChild(n),x.appendChild(e)}}function i(){var e=document.body.querySelector("#treeViewLoading");null!==e&&e.parentNode.removeChild(e)}function m(){var e=document.createElement("ul");return e.classList.add("treeBranch"),e}function q(e,t,n){var a=document.createElement("li");a.classList.add("treeNode"),a.setAttribute("draggable",!0);var r=e.state||{};r.expanded&&a.classList.add("expanded"),r.selected&&a.classList.add("selected"),a.setAttribute("data-index",n);var d=document.createElement("span");d.classList.add("treeNodeItem");var o=document.createElement("span");o.classList.add("treeNodeExpandIcon");var s=document.createElement("span");s.classList.add("treeNodeIcon");var l,i=document.createElement("span");(i.classList.add("treeNodeText"),i.innerHTML=e.text,y.checkboxes&&y.checkboxFirst)&&((l=document.createElement("input")).classList.add("treeNodeCheckbox"),l.setAttribute("type","checkbox"),d.appendChild(l));(d.appendChild(o),d.appendChild(s),d.appendChild(i),y.checkboxes&&!y.checkboxFirst)&&((l=document.createElement("input")).classList.add("treeNodeCheckbox"),l.setAttribute("type","checkbox"),d.appendChild(l));a.appendChild(d);var c=t+1,u=b(e.nodes,c,n),p=document.createElement("span");return p.classList.add("treenode-arrow"),p.innerHTML="&#10239;",null!==u&&(a.appendChild(u),a.classList.add("expandable")),o.appendChild(p),a}function b(e,t,n){if(void 0===e||0===e.length||t>=y.maxLevels&&-1<y.maxLevels)return null;var a=m();for(var r in""!==n||a.classList.contains("root")||(a.classList.add("root"),""!==y.style&&a.classList.add(y.style)),e){var d=n+(""!==n?".":"")+r,o=e[r],s=q(o,t,d);o.index=d,a.appendChild(s)}return a}function c(e){w(e.target.parentNode.parentNode,{silent:!1,fadeOnRemove:y.fadeOnRemove})}function u(e,t){var n=e.target,a=(s=n.parentNode.parentNode).getAttribute("data-index"),r=function(){_({silent:!0});var e=document.createElement("span");e.classList.add("treeview-popup"),e.setAttribute("id","treeviewPopup");var t=document.createElement("span"),n=document.createElement("button");n.setAttribute("type","button"),n.classList.add("button-close"),n.innerHTML="&times;",t.appendChild(n),e.appendChild(t);var a=document.createElement("span"),r=document.createElement("input");r.setAttribute("type","text");var d=document.createElement("button");return d.setAttribute("type","button"),d.classList.add("button-save-changes"),d.innerHTML="Change",a.appendChild(r),a.appendChild(d),e.appendChild(a),window.setTimeout(function(){e.classList.add("show")}),[e,r,d]}(),d=r[0],o=r[1];r[2];l=O(a,N),o.value=l.text,s.appendChild(d)}function p(){var e,t,n,a,r,d=document.querySelector('#treeviewPopup input[type="text"]');s.querySelector("#treeviewPopup").classList.remove("show"),e=s.querySelector(":scope > .treeNodeItem > .treeNodeText"),t=l,n=d.value,a={silent:!1},r=t.text,t=n,e.innerHTML=n,a.silent||z(e,e.parentNode.parentNode,"vtv.nodeChanged",{from:r,to:n})}function g(e,t){var n=e.target,a=(s=n.parentNode.parentNode).getAttribute("data-index"),r=function(){_({silent:!0});var e=document.createElement("span");e.classList.add("treeview-popup"),e.setAttribute("id","treeviewPopup");var t=document.createElement("span"),n=document.createElement("button");n.setAttribute("type","button"),n.classList.add("button-close"),n.innerHTML="&times;",t.appendChild(n),e.appendChild(t);var a=document.createElement("span"),r=document.createElement("input");r.setAttribute("type","text");var d=document.createElement("button");return d.setAttribute("type","button"),d.classList.add("button-save-add"),d.innerHTML="Add",a.appendChild(r),a.appendChild(d),e.appendChild(a),window.setTimeout(function(){e.classList.add("show")},0),[e,r,d]}(),d=r[0];r[1],r[2];l=O(a,N),s.appendChild(d)}function k(e,t,n){var a=e.getAttribute("data-index"),r=a.split(".").length,d=a+(""!==a?".":"")+e.querySelectorAll(":scope > ul > li").length,o=q(t,r,d),s=e.querySelector(":scope > ul.treeBranch");s||(s=m(),e.appendChild(s)),s.appendChild(o),e.classList.contains("expandable")||e.classList.add("expandable"),t.index=d;for(var l=a.split("."),i=(e=null,N),c=0;c<l.length;c++){var u=l[c];if(null===e){if((e=i[u]).index===d)break}else{u=l[c];var p=e.nodes[u];if(p.index===d)break;e=p}}e.nodes[e.nodes.length]=t,n.silent||z(o,e,"vtv.nodeAdded")}function w(e,t){var n=K(e),a=n[0],r=n[1],d=n[2],o=n[3];J(a);return t.fadeOnRemove?(r.classList.add("removing"),setTimeout(function(){L(r,t),E(x.querySelector(":scope > ul.treeBranch"),{nodes:N}),t.silent||z(r,o,"vtv.nodeRemoved")},1e3*y.animationLength)):L(r,t),t.fadeOnRemove||(E(x.querySelector(":scope > ul.treeBranch"),{nodes:N}),t.silent||z(r,o,"vtv.nodeRemoved")),[r,d]}function L(e,t){var n=e.getAttribute("data-index");e.parentNode.removeChild(e);var a=O(n,N);T(n,N);return a}function B(e){y.checkboxes&&(x.querySelectorAll(".treeNode.expanded > .treeNodeItem > .treeNodeCheckbox > input").forEach(function(e){e.setAttribute("checked",""),G(O(e.parentNode.parentNode.parentNode.getAttribute("data-index"),[treeNode]),"checked",!0,!1)}),e.silent||z(x.querySelector(".treeBranch.root"),x,"vtv.allOpenedNodesChecked"))}function O(e,t){for(var n=e.split("."),a=null,r=0;r<n.length;r++){var d=n[r];if(null===a){if((a=t[d]).index===e)return a}else{d=n[r];var o=a.nodes[d];if(o.index===e)return o;a=o}}return null}function T(e,t){for(var n=!1,a=t.length-1;0<=a;a--){var r=t[a];if(void 0!==r){if(e===r.index)return t.splice(a,1),!0;if(n=T(e,r.nodes))return n}}return!1}function H(e){var t=e.target;t.setAttribute("data-class",t.className),v=t,this.classList.add("hold"),setTimeout(function(){t.classList.add("dragging")},0),z(t,x,"vtv.nodeDragStarted")}function D(e){var t=e.target;t.className=t.getAttribute("data-class"),z(t,t,"vtv.nodeDragEnded")}function M(e){e.preventDefault();var t=e.target;z(v,t,"vtv.nodeDragOver")}function I(e){e.preventDefault();var t=e.target;t.classList.add("hovered"),null!==h&&null!==h.parentNode&&(h.parentNode.removeChild(h),f.parentNode.removeChild(f)),h=n("top"),f=n("bottom"),t.appendChild(h),t.appendChild(f),z(v,t,"vtv.nodeDragEnter")}function R(e){var t=e.target;t.classList.remove("hovered"),z(v,t,"vtv.nodeDragLeaved")}function P(e,t,n,a){var r=e.splice(t,1);n.splice(a,0,r[0])}function J(e){for(var t=e.split("."),n=null,a=null,r=N,d=0;d<t.length;d++){var o=t[d];if(null===(a=n)){if((n=r[o]).index===e)return a}else{o=t[d];var s=n.nodes[o];if(null==s)return n;if((n=s).index===e)return a}}return null}function F(e){var t=e.target;t.classList.remove("hovered");var n=e.layerY;if(n<=10){var a=t.parentNode,r=(c=(i=v.getAttribute("data-index")).split("."))[c.length-1],d=J(i),o=(l=(u=t.getAttribute("data-index")).split("."))[l.length-1],s=J(u);a.insertBefore(v,t),P(d.nodes,r,s.nodes,o),E(x.querySelector(":scope > ul.treeBranch"),{nodes:N}),null!==h&&null!==h.parentNode&&(h.parentNode.removeChild(h),f.parentNode.removeChild(f))}else if(n>=t.offsetHeight-10){a=t.parentNode,r=(c=(i=v.getAttribute("data-index")).split("."))[c.length-1],d=J(i);var l=(u=t.getAttribute("data-index")).split(".");o=parseInt(l[l.length-1],10)+1,s=J(u);(a=t.parentNode).insertBefore(v,t.nextSibling),P(d.nodes,r,s.nodes,o),E(x.querySelector(":scope > ul.treeBranch"),{nodes:N}),null!==h&&null!==h.parentNode&&(h.parentNode.removeChild(h),f.parentNode.removeChild(f))}else{a=t.parentNode,r=(c=(i=v.getAttribute("data-index")).split("."))[c.length-1],d=J(i),l=(u=t.getAttribute("data-index")).split("."),o=parseInt(l[l.length-1],10)+1,s=J(u+".0");var i,c,u,p=t.querySelector(".treeBranch");if(p||(p=m(),t.appendChild(p)),null!==h&&null!==h.parentNode&&(h.parentNode.removeChild(h),f.parentNode.removeChild(f)),p.parentNode===v)return;p.appendChild(v),P(d.nodes,r,s.nodes,o),t.classList.contains("expandable")||t.classList.add("expandable"),E(x.querySelector(":scope > ul.treeBranch"),{nodes:N})}z(v,t,"vtv.nodeDragDropped"),v=null}function n(e){var t=document.createElement("span");return t.classList.add("treeNode-spanner"),t.classList.add("spanner-"+e),t}function V(e){var t,n=e.target;if(n.classList.contains("button-close")&&_({silent:!1}),n.classList.contains("button-save-changes")&&p(),n.classList.contains("button-save-add")&&(t=document.querySelector('#treeviewPopup input[type="text"]'),s.querySelector("#treeviewPopup").classList.remove("show"),k(s,{text:t.value,nodes:[]},{silent:!1})),n.classList.contains("button-delete")){var a=e.target.parentNode.parentNode.parentNode;a.classList.contains("root")&&y.rootDelete?c(e):a.classList.contains("root")||c(e)}(n.classList.contains("button-change")&&u(e),n.classList.contains("button-add")&&g(e),n.classList.contains("treeNodeExpandIcon"))&&(n.parentNode.parentNode.classList.contains("expandable")&&n.parentNode.parentNode.classList.toggle("expanded"));if(n.classList.contains("treeNode")){y.showControlsOnHover&&j({target:n});var r=K(n)[2];if(void 0===r.selectable||r.selectable){if(!y.selectMultiple){var d=x.querySelector(".selected");null!==d&&d.classList.remove("selected")}y.canDeselect?n.classList.toggle("selected"):n.classList.contains("selected")||n.classList.add("selected")}}}function j(e){var t=e.target;if(t.classList.contains("treeNode")){var n,a;null!==(n=x.querySelector("#treenodeButtonBar"))&&n.parentNode.removeChild(n),(n=document.createElement("span")).classList.add("treenode-button-bar"),n.setAttribute("id","treenodeButtonBar");var r=document.createElement("button");r.classList.add("treenode-button"),r.classList.add("button-delete"),r.setAttribute("draggable",!1),(a=document.createElement("span")).classList.add("treenode-icon"),a.innerHTML="&#128465;",r.append(a);var d=document.createElement("button");d.classList.add("treenode-button"),d.classList.add("button-change"),d.setAttribute("draggable",!1),(a=document.createElement("span")).classList.add("treenode-icon"),a.innerHTML="&#128393;",d.append(a);var o=document.createElement("button");o.classList.add("treenode-button"),o.classList.add("button-add"),o.setAttribute("draggable",!1),(a=document.createElement("span")).classList.add("treenode-icon"),a.innerHTML="&#10133;",o.append(a),n.appendChild(r),n.appendChild(d),n.appendChild(o),t.appendChild(n)}}function Y(e){var t=e.target;if(t.classList.contains("treeNode")){var n=e.toElement||e.relatedTarget;if(n&&n.parentNode===t||n&&n.parentNode.parentNode===t||n&&n===t)return;var a=t.querySelector("#treenodeButtonBar");if(null===a)return;t.removeChild(a)}}function _(e){var t,n=document.querySelector("#treeviewPopup");n&&(t=n.querySelector("button.button-close"),n.parentNode.removeChild(n),e.silent||z(t,n,"vtv.popupClosed"))}function z(e,t,n,a){null==a&&(a={});var r=A({target:t,source:e},a),d=new Event(n,{bubbles:!0});d.data=r,e.dispatchEvent(d)}function G(e,t,n,a){if(e.state||(e.state={}),e.state[t]=n,a)for(var r=e.nodes||[],d=0;d<r.length;d++){G(e=r[d],t,n,a)}}function K(e){var t,n,a,r;return"string"==typeof e?(t=e,r=(n=x.querySelector('[data-index="'+t+'"]')).parentNode,a=O(t,N)):void 0!==e.style?(r=(n=e).parentNode,a=O(t=e.getAttribute("data-index"),N)):(t=(a=e).index,r=(n=x.querySelector('[data-index="'+t+'"]')).parentNode),[t,n,a,r]}return e}();
